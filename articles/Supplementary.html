<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="dafishr">
<title>Supplementary Information of: • dafishr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Supplementary Information of:">
<meta property="og:description" content="dafishr">
<meta property="og:image" content="https://cbmc-gcmp.github.io/dafishr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">dafishr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Supplementary.html">Supplementary Information of:</a>
    <a class="dropdown-item" href="../articles/dafisr.html">Where to start</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/CBMC-GCMP/dafishr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="Supplementary_files/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="Supplementary_files/htmlwidgets-1.5.4/htmlwidgets.js"></script><script src="Supplementary_files/viz-1.8.2/viz.js"></script><link href="Supplementary_files/DiagrammeR-styles-0.2/styles.css" rel="stylesheet">
<script src="Supplementary_files/grViz-binding-1.0.9/grViz.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Supplementary Information of:</h1>
            <h3 data-toc-skip class="subtitle">Large Marine Protected Areas implementation has minimal impacts on catches or dispalcement of fishing industry footprint</h3>
            
      
      <small class="dont-index">Source: <a href="https://github.com/CBMC-GCMP/dafishr/blob/HEAD/vignettes/Supplementary.Rmd" class="external-link"><code>vignettes/Supplementary.Rmd</code></a></small>
      <div class="d-none name"><code>Supplementary.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="context">Context<a class="anchor" aria-label="anchor" href="#context"></a>
</h2>
<p>Implementing fully protected Large Marine Protected Areas (LMPAs) is important to preserve food, curb overfishing, and halt biodiversity loss. International commitments in the form of area-based targets have given much popularity to LMPAs but also drew criticism from a fishery perspective. In our study, we analyzed the fishing activity of Mexican industrial vessels and found that current fishing activity within LMPA is minimal. The industrial fishing footprint was not affected by establishing an LMPA, which successfully reduced the fishing pressure within its polygon. No decrease in catches or fishing effort displacement could be observed after MPA implementation. This study proves the usefulness of open VMS data in MPA assessment, monitoring, and fishery management. Fully protecting existing remote areas would be a first step towards fulfilling the ambitious 30x30 conservation target, which will require the establishment of LMPAs strategically placed within a conservation network that can efficiently curb human impacts.</p>
<div id="htmlwidget-1ed5144c4acb18eeabfb" style="width:700px;height:432.632880098888px;" class="grViz html-widget"></div>
<script type="application/json" data-for="htmlwidget-1ed5144c4acb18eeabfb">{"x":{"diagram":"digraph flowchart {\n      # node definitions with substituted label text\n      node [fontname = Helvetica, shape = rectangle]        \n      tab1 [label = \"Download raw data with vms_download()\"]\n      tab2 [label = \"Preprocessing VMS data\"]\n      tab3 [label = \"Summarise statistics within EEZ, MPAs, High Seas, and buffers\"]\n      tab4 [label = \"Causal Impact modeling\"]\n      tab5 [label = \"Normalized Difference Index on rasters\"]\n      tab6 [label = \"Change in catches over the years\"]\n\n      # edge definitions with the node IDs\n      tab1 -> tab2 -> tab3 -> tab4 -> tab5 -> tab6;\n      }","config":{"engine":"dot","options":null}},"evals":[],"jsHooks":[]}</script>
</div>
<div class="section level2">
<h2 id="raw-data-download">Raw data download<a class="anchor" aria-label="anchor" href="#raw-data-download"></a>
</h2>
<p>The first step is downloading raw VMS data using the <code><a href="../reference/vms_download.html">vms_download()</a></code> function. This connects to the <a href="https://www.datos.gob.mx/busca/dataset/localizacion-y-monitoreo-satelital-de-embarcaciones-pesqueras/resource/309e872a-dbca-4962-b14f-f0da833abebe" class="external-link">Datos Abiertos</a> webpages and download the original data. Data comes as several <code>.csv</code> files within sub-folder order by month. Often <code>.csv</code> data are split by-weekly. You can download all of the years available by running:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/CBMC-GCMP/dafishr" class="external-link">dafishr</a></span><span class="op">)</span>

<span class="va">year</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2008</span><span class="op">:</span><span class="fl">2021</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">vms_download</span><span class="op">)</span></code></pre></div>
<p>Speed of download depends on your internet connection and might take a while. All data are stored within your working directory under the <code>VMS-data</code> folder by default.</p>
</div>
<div class="section level2">
<h2 id="preprocessing-vms-data">Preprocessing VMS data<a class="anchor" aria-label="anchor" href="#preprocessing-vms-data"></a>
</h2>
<p>Raw VMS data need to be preprocessed in order to have tidy datasets. The processing consist several steps:</p>
<ul>
<li><p><strong><em>Data wrangling</em></strong>: standardizing column names, formatting dates, and filtering out mistake within raw data. Sometimes for example data are misplaced or can have <code>NULL</code> entries. These need to be eliminated.</p></li>
<li><p><strong><em>Spatial corrections</em></strong>: it eliminates all coordinates that fall inland because of ping errors or data entry errors.</p></li>
<li><p><strong><em>Spatial joining</em></strong>: it spatially joins all the VMS points with port areas and with MPA polygons.</p></li>
</ul>
<p>Since the raw VMS data folder contains several <code>.csv</code> files that are quite big if joined together, the processing would quickly saturate RAM memory of any personal computer. Therefore, a piece meal strategy is adopted by maintaining each file separated and working on in independently for the preprocessing phase. This also allows to include a parallel processing approach by looping each of the raw file and creating the outputs separately inside a standard <code>preprocessed</code> folder. Outputs files will be in <code>.fst</code> format which is awesome to handle large datasets (see <code>fst</code> <a href="https://www.fstpackage.org/" class="external-link">package</a> documentation for further information).</p>
<div class="section level3">
<h3 id="disclaimer">❗DISCLAIMER ❗<a class="anchor" aria-label="anchor" href="#disclaimer"></a>
</h3>
<div class="section level4">
<h4 id="note-on-setting-cpu-cores">Note on setting CPU cores<a class="anchor" aria-label="anchor" href="#note-on-setting-cpu-cores"></a>
</h4>
<p>To speed up the process, we use parallel processing. If you don’t know what that is, you might want to stop and contact us before continuing. We will make use of the <code>future.lapply</code> package that allow things to run in parallel processing using the cores in your CPU. You can set how many CPU you want to use In the <code>plan()</code> function. While you can go full throttle on this, we strongly advise you don’t, as data will saturate your RAM. I personally tested these functions on a XPS dell with an Intel(R) Core(TM) i9/9980HK CPU at 2.40 GHz with 8 cores and 32 GB of RAM, and if I go full throttle it fails because of RAM. Unless you are running this on a server, I am pretty sure that it will fail on your PC too. If you have any question, comments, or advice these are welcome and please, contact me! In short, it make sense to use 2 to 4 cores, it will take more time but it won’t fail or burn your RAM. We take <strong><em>NO</em></strong> responsibility whatsoever in any damages to personal belongings that might come from running this recklessly, so please don’t try this at home if you don’t know what you are doing.</p>
<p><em>If you feel safer NOT using parallel processing you can do that! We provide an example right after this one.</em></p>
<p>It is time to put all this to the test! First we will load the <code>future.lapply</code> package for parallel processing, which parallelize <code>lapply</code> like functions in <code>R</code>. Then we’ll create the list of raw files within the downloaded folder and apply the function <code><a href="../reference/preprocessing_vms.html">preprocessing_vms()</a></code>. Once you run it, go grab a coffee ☕, maybe even two☕☕, or actually don’t, maybe take a quick nap 🛌… as it will take <strong><em>a while</em></strong> if run on the full data. If you just want to test it out, you can use the function only on one year by specifying the folder containing only one year worth of data (or less, if you want).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.apply.futureverse.org" class="external-link">future.apply</a></span><span class="op">)</span> <span class="co"># this library is need for parallel processing</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org" class="external-link">fst</a></span><span class="op">)</span> <span class="co"># this allows to load fst type of files</span>

<span class="co"># Creating a list of file names from downloaded data (change the path if needed)</span>
<span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>
                        <span class="st">"VMS-data/"</span>,
                        pattern <span class="op">=</span> <span class="st">".csv"</span>,
                        full.names <span class="op">=</span> <span class="cn">T</span>,
                        recursive <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>

<span class="co"># this plans a parallel session, set workers carefully according to your CPU capabilities</span>
<span class="co"># here I conservatively set it to 2 cores.</span>
<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># This runs the function in parallel and times it</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">future_lapply</span><span class="op">(</span><span class="va">file_names</span>, <span class="va">preprocessing_vms</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>If you chose NOT to run in parallel you can do the following. In this case, definitely go take a nap, because it will take much more time. You can set a sound alert using the <code>beepr</code> package to wake you up when it’s done if you want 😃.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.fstpackage.org" class="external-link">fst</a></span><span class="op">)</span> <span class="co"># this allows to load fst type of files</span>

<span class="co"># Creating a list of file names from downloaded data (change the path if needed)</span>
<span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>
                        <span class="st">"VMS-data/raw/"</span>,
                        pattern <span class="op">=</span> <span class="st">".csv"</span>,
                        full.names <span class="op">=</span> <span class="cn">T</span>,
                        recursive <span class="op">=</span> <span class="cn">T</span>
            <span class="op">)</span>


<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">file_names</span>, <span class="va">preprocessing_vms</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="vms-modeling-with-gaussian-mixed-models">VMS modeling with Gaussian Mixed Models<a class="anchor" aria-label="anchor" href="#vms-modeling-with-gaussian-mixed-models"></a>
</h2>
<p>In this section we will model the preprocessed VMS data with Gaussian Mixed Models.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">file_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>
            <span class="st">"preprocessed/"</span>,
            pattern <span class="op">=</span> <span class="st">".fst"</span>,
            full.names <span class="op">=</span> <span class="cn">T</span>,
            recursive <span class="op">=</span> <span class="cn">T</span>
<span class="op">)</span>

<span class="va">looping_model</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
            <span class="va">vms</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">read_fst</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>
            <span class="va">vms_modelled</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/model_vms.html">model_vms</a></span><span class="op">(</span><span class="va">vms</span><span class="op">)</span>
            
            <span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="st">"outputs/"</span><span class="op">)</span>
            <span class="fu"><a href="http://www.fstpackage.org/reference/write_fst.html" class="external-link">write_fst</a></span><span class="op">(</span><span class="va">vms_modelled</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"outputs/"</span>, <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vms</span><span class="op">$</span><span class="va">year</span><span class="op">)</span>, <span class="st">"_"</span>, 
                             <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">vms</span><span class="op">$</span><span class="va">month</span><span class="op">)</span>, <span class="st">"_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">vms</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>, <span class="st">"_"</span>, 
                             <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">vms</span><span class="op">$</span><span class="va">day</span><span class="op">)</span>, <span class="st">"_modeled.fst"</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span>

<span class="fu">plan</span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>

<span class="co"># This runs the function in parallel and times it</span>
<span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="fu">future_lapply</span><span class="op">(</span><span class="va">file_names</span>, <span class="va">looping_model</span>, future.seed <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Fabio Favoretto.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
